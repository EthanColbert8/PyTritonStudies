import plotting

save_folder = "/depot/cms/users/colberte/SONIC/Scans/comparisons"
save_name = "comparison_particlenet-pt_01-27-24"
#save_name = "V100_A30_A100_MI100_deepmet_comparison_new.png"

######## ParticleNet (ONNX) ########
# T4_info = {
#     'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
#     'throughput': [1774.6310026947292, 2671.571525158178, 3585.9798220905773, 4208.995195913258, 4486.510587466162, 4624.3225366549095, 4698.801781719015, 4565.7845139798, 4462.443130062966, 4365.546925197751],
#     'latency': [2.7126661899999998, 3.52814765, 4.926460680000002, 7.87915253, 14.419367000000005, 27.724642090000003, 54.51585286, 112.17653047, 229.47688458000005, 469.14526071000006],
#     'name': "Nvidia T4",
#     'color': '#e42536',
# }
# V100_info = {
#     'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
#     'throughput': [1510.4324673604674, 1976.772034535826, 4511.602330175681, 7690.026726645595, 10057.256900815453, 11589.76495861704, 12490.551072096783, 13044.83240090102, 13305.15483959488, 13481.231785972468],
#     'latency': [3.26680558, 4.39730897, 4.55558036, 4.712980520000001, 6.67730302, 11.314755810000001, 20.690159360000003, 39.296632030000005, 77.01334716, 151.91495257],
#     'name': "Nvidia V100 (32GB)",
#     'color': '#f89c20',
# }
# A100_info = {
#     'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
#     'throughput': [1058.7931533448316, 2224.0555881046803, 4088.732850126853, 10016.732861497665, 15153.182608816096, 19771.226978716448, 21023.0769969828, 20545.623661493337, 23905.871469594465, 24385.810948535935],
#     'latency': [3.8139993400000005, 3.63479743, 5.02017831, 4.36249963, 4.954942910000001, 6.880795280000002, 12.39552062, 25.158163879999996, 42.887490299999996, 84.00423312000001],
#     'name': "Nvidia A100 (40 GB)",
#     'color': '#964a8b',
# }
# A30_info = {
#     'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
#     'throughput': [1821.493627465826, 3252.883241722367, 5609.682440345116, 7959.963820672067, 10383.550566583737, 11860.708718903714, 12867.067038378069, 13484.351523067384, 13760.83339910296, 13662.378458194153],
#     'latency': [2.7772505499999998, 3.1646343999999997, 3.4877540899999997, 4.439695890000001, 6.3659496, 10.938322880000001, 20.0222377, 37.99050286, 74.42816869, 149.90151993],
#     'name': "Nvidia A30",
#     'color': '#9c9ca1',
# }
# MI100_info = {
#     'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
#     'throughput': [2681.3040815924473, 4463.817178540191, 6946.649079329508, 9764.879291008063, 12186.972639940745, 13802.076000608022, 15367.685339636451, 16312.400330599681, 16391.58472761094, 16456.10702138114],
#     'latency': [1.49993855, 1.79237202, 2.30443229, 3.281689270000001, 5.260859460000001, 9.280878660000003, 16.663216100000003, 31.387745879999997, 62.47629806, 124.45384196],
#     'name': "AMD MI100",
#     'color': '#5790fc',
# }

######## ParticleNet (PyTorch) ########
direct_info = {
    "Nvidia A10": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [2617.4568511651355, 5160.556046593553, 8866.363848579804, 12880.154902990085, 14944.339039463448, 16232.547658195825, 17476.02205543199, 16459.585771173835, 16270.090385047697, 16212.291730263138],
        'throughput_error': [27.104087500512428, 54.06494062368101, 92.32004947329759, 46.13511912547772, 185.608946814207, 441.9732244361047, 1090.9675499775574, 182.9310482724141, 76.04740408305261, 27.837773708863494],
        'latency': [18.300837120000004, 17.74601688, 21.7337214, 2.4870062600000002, 4.313292110000001, 8.04826254, 15.493923869999998, 31.291205639999998, 63.03216762000001, 126.35604954000001],
        'latency_error': [16.702640218658853, 16.128406121777783, 19.845543393812022, 0.00722777270639607, 0.025038150180929482, 0.06018078330173415, 0.13572516217789293, 0.16627606038095713, 0.2024933690319181, 0.18729747751302656],
        'color': '#7a21dd',
    },
    "Nvidia A30": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [1792.3851581833044, 3238.2929192211, 5272.582259161219, 11287.177393638058, 18938.38500298096, 22251.344251988492, 25322.297737275363, 25979.010769760458, 26540.021511940813, 26034.8421867558],
        'throughput_error': [18.419713533560266, 37.503240136341105, 62.05183583704695, 23.402459740844282, 105.34092276164063, 168.69454003525266, 353.05559968220143, 825.7149722537977, 533.0049452497285, 193.08055929521353],
        'latency': [31.447398120000006, 30.638284359999997, 38.02084578, 2.83635241, 3.3896046800000006, 5.774168990000001, 10.196616560000002, 20.210177700000003, 39.128357959999995, 78.92264912000002],
        'latency_error': [29.09041917200875, 28.040240993772294, 34.829883294021165, 0.006159401313197493, 0.018407997910668505, 0.029343141654923372, 0.06377431532277758, 0.16104170486781522, 0.27744993699584003, 0.35149310076463786],
        'color': '#9c9ca1',
    },
    "Nvidia A100 (40 GB)": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [1990.5718532524706, 3888.5415788948767, 6731.741794783817, 13678.976731974377, 26519.892749978375, 39616.81422067038, 46541.41532060042, 51460.69101721085, 54341.96777528837, 53150.4751269063],
        'throughput_error': [22.633918115096527, 40.080390607691214, 69.53759677710252, 17.150874133892223, 55.12458866044845, 127.61688156375564, 464.80821985720604, 1144.629286167361, 2178.716475422979, 620.174480442704],
        'latency': [25.93836399, 25.18396601, 31.00683136, 2.33972271, 2.41445827, 3.2336885099999995, 5.52861167, 10.113021460000002, 19.47685577, 38.78091714000001],
        'latency_error': [23.81815326279145, 23.029966753733525, 28.508558690847035, 0.002922872657893089, 0.005674399045993418, 0.008545058421865762, 0.028302391393795874, 0.07767530606473647, 0.1582276312009896, 0.21449156863902133],
        'color': '#964a8b',
    },
    "Nvidia V100 (32 GB)": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [1823.1877700016041, 3535.665800065387, 6017.512598402051, 11625.266678869548, 15627.08043074865, 18018.27144741595, 19582.984046288813, 19989.808140314635, 20412.512505226434, 20541.496465723616],
        'throughput_error': [18.60636623805972, 36.64758455445145, 63.314785524202684, 17.924187679417724, 47.125975410804, 257.39631131781255, 322.5430853617638, 72.28620867373562, 50.17331277571621, 26.329864976317868],
        'latency': [22.982352110000008, 21.444609319999998, 26.81628279, 2.7532848899999998, 4.09885358, 7.1650195199999995, 13.209627300000001, 25.639520060000006, 50.19054174000001, 99.71563469],
        'latency_error': [20.705225766673372, 19.106481628015985, 24.059579671103073, 0.004280853196335867, 0.011320141150552677, 0.04293906902545391, 0.08337832442191019, 0.07349458917053392, 0.1029175034337684, 0.11720958326726938],
        'color': '#f89c20',
    },
    "AMD MI100": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [2357.2207405306053, 4633.591906303943, 8107.552088281931, 14317.082706734016, 18111.878925512956, 21635.96193420032, 24331.131626932227, 25698.09115838416, 26807.758361370004, 28118.85746552589],
        'throughput_error': [23.867751390948804, 48.8354583310292, 85.03670088968929, 26.502242397997595, 91.98850227085327, 177.00262113735286, 535.2407095477722, 1227.2247039906022, 2435.0991438956726, 4033.126578030033],
        'latency': [36.961347690000004, 36.590958490000006, 40.57533857000001, 2.23587404, 3.5477439200000003, 5.938771940000001, 10.685739990000002, 20.757858740000007, 41.65400074, 84.30030105000002],
        'latency_error': [35.10425704318787, 34.70447451313465, 38.42564209733323, 0.004225155301546204, 0.02860627140416828, 0.028010357733509295, 0.0751009387792423, 0.17703388750988872, 0.38090089521710413, 0.8005640410054639],
        'color': '#5790fc',
    },
    "AMD MI210": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [2040.8633116328906, 3986.9934655896086, 7070.2554660719225, 14154.342702546406, 19942.267333515578, 23291.919560382354, 25826.61786753675, 27045.067992210305, 28095.972176642492, 29781.381316142903],
        'throughput_error': [20.605693893247448, 41.60348790193297, 73.83064836849135, 13.25841506859166, 53.15313119018121, 256.7145652013413, 726.2768703359313, 1566.715166006385, 3011.3273116879245, 5318.93055611739],
        'latency': [37.45616673000001, 37.47481708, 41.448514190000004, 2.26100413, 3.2110908000000005, 5.527715059999999, 10.1246904, 19.92894566, 40.47011002000001, 83.01380917],
        'latency_error': [35.337562288322296, 35.308342547875895, 39.00914708268987, 0.0022840524837514113, 0.006859734425311234, 0.029277244471089897, 0.07556339738501837, 0.17232346583770777, 0.37581065251872736, 0.7993824837000851],
        'color': '#e42536',
    },
}

triton_info = {
    "Nvidia A10": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [1846.7151532253388, 3655.953899113939, 6935.592359371368, 10546.60368297961, 12657.641247431142, 14069.721463435511, 14251.340764549868, 14722.734359806185, 15006.450874202961, 15364.887696400136],
        'throughput_error': [21.109417648370787, 15.688187044474521, 29.146690170590897, 41.17885690802923, 39.29116783994283, 33.04901699311266, 42.968531565509366, 55.551326410740764, 65.04531954682612, 11.572546071667164],
        'latency': [54.127954400000014, 2.19367043, 2.3123560800000003, 3.0395935600000006, 5.061717970000001, 9.102576840000001, 17.979498609999997, 34.828743720000006, 68.37396465, 133.2985174],
        'latency_error': [51.71322052838913, 0.012819584517153856, 0.013052140164284784, 0.014000001848287879, 0.017748921394476085, 0.021410924278067598, 0.05404708509295371, 0.139523662306621, 0.31536606812906154, 0.10089224188666923],
        'color': '#7a21dd',
    },
    "Nvidia A30": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [903.8044158315483, 1799.832089197461, 3505.0667736555242, 5688.202255580209, 7583.941718237075, 9008.017413121792, 10669.225972516875, 11569.938481399991, 12204.12831940545, 13884.896058908245],
        'throughput_error': [10.674746817564348, 9.322379084569718, 18.83668148757177, 42.15010366093871, 34.24174705959787, 32.77031435557437, 52.65489751286323, 42.54931987441378, 32.011959654741176, 79.10815613172925],
        'latency': [96.99187514, 4.4594904, 4.5790364199999996, 5.6625450000000015, 8.456299410000003, 14.228856060000004, 24.051555129999997, 44.31413106, 83.96473083000001, 148.01542156000002],
        'latency_error': [92.12654823458011, 0.028471180059319635, 0.02651921709480572, 0.051077626251600616, 0.03864505579672799, 0.053149559778189734, 0.11641498005486639, 0.16767545261557157, 0.223939483344547, 0.908789968020244],
        'color': '#9c9ca1',
    },
    "Nvidia A100 (40 GB)": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [1466.9237842010562, 2897.264497757783, 5774.376243360039, 9970.224391295382, 13622.567306760899, 15727.336177013665, 17583.46290081056, 19885.989063743215, 21146.960453292057, 21856.845028746477],
        'throughput_error': [15.625573844607757, 9.15116423302768, 17.131159526322865, 28.473564335726003, 67.46144100133235, 35.0062532512527, 50.386777990596, 53.765304183434715, 39.0793086653802, 44.4225538740197],
        'latency': [77.67027830000002, 2.7646614900000004, 2.7738664299999995, 3.21249303, 4.716398900000001, 8.142744070000001, 14.57197575, 25.76556268, 48.439570270000004, 93.7397866],
        'latency_error': [74.59026459530136, 0.010927762567831487, 0.010193278683301613, 0.01032230270595137, 0.03758090760758845, 0.018200334391863547, 0.04501543067097409, 0.0695617453829817, 0.08952611676775318, 0.19278610274563718],
        'color': '#964a8b',
    },
    "Nvidia V100 (32 GB)": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [1403.260141372878, 2767.648132563358, 5224.131488326674, 8508.77892836534, 10626.0234021578, 11824.262816326089, 12542.94415844804, 12756.714619145429, 13008.04576380949, 13729.71800757305],
        'throughput_error': [15.681745598161166, 11.942460287268366, 24.52201236156437, 51.18169259031354, 32.12264342063795, 35.7823823375047, 36.48582039716502, 40.08761029927223, 30.92191482370371, 37.273054344629074],
        'latency': [70.11005682, 2.8974750400000007, 3.0713729399999994, 3.78191423, 6.0296693, 10.836231799999997, 20.427520270000002, 40.175316030000005, 78.76615413, 149.27735260000003],
        'latency_error': [66.9407889556647, 0.016175664113729112, 0.01860053966958389, 0.035678895544475175, 0.022403221067830846, 0.03663873464899407, 0.0607304574253576, 0.12619561452401704, 0.19215366810146287, 0.4126591322258931],
        'color': '#f89c20',
    },
    "AMD MI100": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [737.9635809554619, 1432.2559070768723, 2466.2036998754356, 3680.441183950424, 4656.157376750463, 10637.088576969432, 13536.830837695325, 14783.702634648502, 15552.299382789279, 15818.841351386061],
        'throughput_error': [10.621049920559148, 15.145521686636332, 25.919648142411756, 11.603822217077564, 37.696658311054605, 29.55158911877545, 43.70711864457797, 46.28784253761135, 39.03423136425572, 44.306713868512695],
        'latency': [31.9304342, 31.25360875000001, 34.924092650000006, 8.70319165, 14.027527150000001, 12.04291644, 18.933019879999996, 34.66719271, 65.88503840000001, 129.56957503],
        'latency_error': [25.745408580198806, 25.58848543611186, 28.351799570872828, 0.027253447331038228, 0.3648648925605675, 0.034397641122891905, 0.06726708095800096, 0.11011389008035118, 0.17017552526857832, 0.37041469223774925],
        'color': '#5790fc',
    },
    "AMD MI210": {
        'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
        'throughput': [750.477272683216, 1408.6254671917618, 2381.577693705071, 3836.826172993911, 4917.1284168444145, 11211.445100154908, 14244.295459776267, 15620.032181885452, 15448.524894476846, 16022.55760096918],
        'throughput_error': [10.469686265880302, 14.490347891309264, 24.44492302313919, 8.18154056817025, 40.30339021093287, 27.84212204294507, 33.98709577039205, 37.40346298193554, 44.81607150721489, 32.71840516256063],
        'latency': [31.79690487, 31.27791201, 35.06400245999999, 8.34402708, 13.309667899999997, 11.42395849, 17.98294412, 32.79766676, 66.34127955999999, 127.87361583],
        'latency_error': [25.71952052203726, 25.523549530936677, 28.26697108604609, 0.017831096211011147, 0.3739604080902156, 0.028417775208736857, 0.0455279929891035, 0.08042751446266644, 0.1953230111312783, 0.2636462180342707],
        'color': '#e42536',
    },
}

######## DeepMET (Tensorflow) ########
# T4_info = {
#     'batch_size': ,
#     'throughput': ,
#     'latency': ,
#     'name': "Nvidia T4",
#     'color': '#e42536',
# }
# V100_info = {
#     'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
#     'throughput': [2464.759178213887, 3825.281571377001, 4602.2848992089475, 5064.925755396175, 6060.187669199425, 5100.191703116571, 4017.23881070375, 4047.368978889214, 3781.512044269236, 3763.659179175782],
#     'latency': [1.6747565000000002, 2.09267325, 3.4838879000000005, 6.332740300000001, 10.5998643, 25.10056335, 63.729593050000005, 126.53249195000001, 271.17068830000005, 544.5249685000001],
#     'name': "Nvidia V100 (32GB)",
#     'color': '#f89c20',
# }
# A100_info = {
#     'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
#     'throughput': [2817.761531883449, 4511.2275548634925, 5768.809462672752, 6044.792148265804, 6219.372263063512, 6150.0572123085585, 6488.263047486394, 6797.66212285748, 6973.40579051587, 7150.074113912195],
#     'latency': [1.435203, 1.78215635, 2.79151885, 5.310565200000001, 10.324819799999998, 21.1117829, 39.460406600000006, 75.43292985000001, 146.84672515000003, 286.44170745],
#     'name': "Nvidia A100 (40 GB)",
#     'color': '#964a8b',
# }
# A30_info = {
#     'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048],
#     'throughput': [2232.1693372378986, 3325.1407090551206, 3767.2245884111353, 4158.898379596854, 4258.52586190397, 3900.872057520291, 3579.1840484326735, 3738.731778804389, 3880.4272114148857, 3618.538277379395],
#     'latency': [1.8231725, 2.42476585, 4.3121638, 7.721611350000001, 15.0998931, 32.9642884, 71.53863285, 136.96388305, 264.6003148, 566.0707449],
#     'name': "Nvidia A30",
#     'color': '#9c9ca1',
# }
# MI100_info = {
#     'batch_size': [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048], #, 4096],
#     'throughput': [2455.5354578382917, 3864.9926861712756, 5413.723800625871, 6825.023087540059, 8244.963417705902, 7822.402807689051, 5470.499247909242, 5457.151713264117, 5634.086779318604, 5641.969681535328], #, 5087.9729982234785],
#     'latency': [1.66214687, 2.0876048000000003, 2.9761427200000004, 4.699904310000001, 7.797242460000002, 16.507140480000004, 47.47595453000001, 93.83795975999999, 181.82255172, 363.41830846000005], #, 805.05750935],
#     'name': "AMD MI100",
#     'color': '#5790fc',
# }

# plot_dict = {
#     # T4_info['name']: T4_info,
#     # A10_info['name']: A10_info,
#     # V100_info['name']: V100_info,
#     # A30_info['name']: A30_info,
#     # A100_info['name']: A100_info,
#     # MI100_info['name']: MI100_info,
#     # MI210_info['name']: MI210_info,
#     "MI210 with Triton": MI210_info,
#     "MI210 direct": MI210_direct_info,
# }

plotting.plot_throughput_latency(direct_info, save_folder+"/"+save_name+"_direct.png", ratio_key="AMD MI100", ratio_label="All / MI100")
plotting.plot_throughput_latency(triton_info, save_folder+"/"+save_name+"_triton.png", ratio_key="AMD MI100", ratio_label="All / MI100")